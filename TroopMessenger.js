const constants=require("./constants");let $this,Emitter=require("events").EventEmitter,moment=require("moment");class TroopMessenger{constructor(e){if(this.token=e,this.user_id="",this.authorization_token="",this.socket=require("socket.io-client"),this.socket_id=null,this.access_token="",this.connection_state="pending",this.uid="",this.axiosRequest=require("axios"),this.axiosRequest.defaults.baseURL="https://apis.troopmessenger.com",this.axiosRequest.defaults.headers.post["Content-Type"]="application/json",this.axiosRequest.defaults.headers.put["Content-Type"]="application/json",this.statuses={status_1:"online",status_2:"do not disturb",status_3:"away "},null===this.token||""===this.token||void 0===this.token)throw Error("Invalid Token!");$this=this}async login(e,t){return await register(e,t,this.token).then(function(t){return $this.uid=e,t}).catch(function(e){return{success:!1,message:"Something went wrong. Please try again after time."}})}async register(e,t){return await register(e,t,this.token,1).then(function(e){return e}).catch(function(e){return{success:!1,message:"Something went wrong. Please try again after time."}})}connect(e,t){let s=new Emitter,o=this;return this.user_id=e,this.authorization_token=t,void 0!==this.user_id&&""!==this.user_id&&this.user_id?void 0!==this.authorization_token&&""!==this.authorization_token&&this.authorization_token?(this.socket=this.socket("https://apis.troopmessenger.com",{query:"user_id="+this.user_id+"&token="+this.token+"&platform=1&checksum=_zxtyuIopQwRt&at="+this.authorization_token+"&uid="+this.uid}),this.socket.on("connect",function(){o.socket_id=this.io.engine.id}),this.socket.on("access_token",function(e){o.access_token=e.access_token,o.connection_state="connected",s.emit("connected")}),this.socket.on("get_account_statuses",function(e){o.statuses=e,s.emit("connected")}),this.socket.on("disconnect",function(){o.connection_state="disconnected",s.emit("disconnected")}),this.socket.on("receive_message",function(e){s.emit("receive_message",e)}),this.socket.on("message_delivered",function(e){s.emit("message_delivered",e)}),this.socket.on("message_read",function(e){s.emit("message_read",e)}),this.socket.on("online",function(e){s.emit("user_online",e)}),this.socket.on("user_dnd",function(e){s.emit("user_dnd",e)}),this.socket.on("user_offline",function(e){s.emit("user_offline",e)}),this.socket.on("group_created",function(e){s.emit("group_created",e)}),this.socket.on("room_created",function(e){s.emit("room_created",e)}),this.socket.on("message_sent",function(e){s.emit("message_sent",e)}),this.socket.on("group_updated",function(e){s.emit("group_updated",e)}),this.socket.on("room_updated",function(e){s.emit("room_updated",e)}),this.socket.on("typing",function(e){s.emit("typing",e)}),this.socket.on("message_deleted",function(e){s.emit("message_deleted",e)}),this.socket.on("message_recalled",function(e){s.emit("message_recalled",e)}),this.socket.on("message_edited",function(e){s.emit("message_edited",e)}),this.socket.on("individual_unread_messages_count",function(e){s.emit("individual_unread_messages_count",e)}),this.socket.on("all_unread_messages_count",function(e){s.emit("all_unread_messages_count",e)}),this.socket.on("user_status_updated",function(e){s.emit("user_status_updated",e)}),s):(setTimeout(function(){s.emit("connect_error","Invalid authorization token")},0),s):(setTimeout(function(){s.emit("connect_error","Invalid user")},0),s)}sendTextMessage(e,t){let s=new Emitter;if("connected"!==this.connection_state)return setTimeout(function(){s.emit("tm_error","Connection to server is not yet established!")},0),s;if(void 0===e||!e||"object"!=typeof e)return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;if(void 0!==t&&t.is_forkout){if(!Array.isArray(e))return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;for(let t=0;t<e.length;t++)e[t].access_token=this.access_token,e[t].message_type=constants.MESSAGE_TYPE.TEXT;this.socket.emit("fork_out",e),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}else{if(void 0===e.receiver_id||!e.receiver_id)return setTimeout(function(){s.emit("tm_error","Invalid Receiver")},0),s;if(void 0===e.is_group)return setTimeout(function(){s.emit("tm_error","Value for 'is_group' not specified")},0),s;if("number"!=typeof e.is_group)return setTimeout(function(){s.emit("tm_error","Invalid value specified for 'is_group'")},0),s;if(void 0===e.is_room&&(e.is_room=0),"number"!=typeof e.is_room)return setTimeout(function(){s.emit("tm_error","Invalid value specified for 'is_room'")},0),s;if(""===e.message)return setTimeout(function(){s.emit("tm_error","Message cannot be empty")},0),s;void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),void 0===e.receiver_uid&&(e.receiver_uid=""),void 0===e.sender_uid&&(e.sender_uid=""),e.is_group=parseInt(e.is_group),e.is_room=parseInt(e.is_room),e.access_token=this.access_token,this.socket.emit("send_message",{receiver_id:e.receiver_id,is_group:e.is_group,is_room:e.is_room,access_token:e.access_token,message:e.message,conversation_reference_id:e.conversation_reference_id,receiver_uid:e.receiver_uid,sender_uid:e.sender_uid,entity:1===e.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER}),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}return s}sendAttachment(e,t){let s=new Emitter;if("connected"!==this.connection_state)return setTimeout(function(){s.emit("tm_error","Connection to server is not yet established!")},0),s;if(void 0===e||!e||"object"!=typeof e)return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;if(void 0!==t&&t.is_forkout){if(!Array.isArray(e))return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;for(let t=0;t<e.length;t++)e[t].access_token=this.access_token,e[t].message_type=constants.MESSAGE_TYPE.ATTACHMENT;this.socket.emit("fork_out",e),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}else{if(void 0===e.receiver_id||!e.receiver_id)return setTimeout(function(){s.emit("tm_error","Invalid Receiver")},0),s;if(void 0===e.is_group)return setTimeout(function(){s.emit("tm_error","Value for 'is_group' not specified")},0),s;if(void 0===e.is_room&&(e.is_room=0),"number"!=typeof e.is_group)return setTimeout(function(){s.emit("tm_error","Invalid value specified for 'is_group'")},0),s;if("number"!=typeof e.is_room)return setTimeout(function(){s.emit("tm_error","Invalid value specified for 'is_room'")},0),s;if(""===e.attachment)return setTimeout(function(){s.emit("tm_error","Attachment cannot be empty")},0),s;void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),e.is_group=parseInt(e.is_group),e.is_room=parseInt(e.is_room),e.access_token=this.access_token,void 0===e.receiver_uid&&(e.receiver_uid=""),void 0===e.sender_uid&&(e.sender_uid=""),void 0===e.caption&&(e.caption=""),this.socket.emit("send_attachment",{receiver_id:e.receiver_id,is_group:e.is_group,is_room:e.is_room,access_token:e.access_token,attachment:e.attachment,conversation_reference_id:e.conversation_reference_id,receiver_uid:e.receiver_uid,sender_uid:e.sender_uid,entity:1===e.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER,caption:e.caption}),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}return s}sendAudioMessage(e,t){let s=new Emitter;if("connected"!==this.connection_state)return setTimeout(function(){s.emit("tm_error","Connection to server is not yet established!")},0),s;if(void 0===e||!e||"object"!=typeof e)return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;if(void 0!==t&&t.is_forkout){if(!Array.isArray(e))return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;for(let t=0;t<e.length;t++)e[t].access_token=this.access_token,e[t].message_type=constants.MESSAGE_TYPE.AUDIO_MESSAGE;this.socket.emit("fork_out",e),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}else{if(void 0===e.receiver_id||!e.receiver_id)return setTimeout(function(){s.emit("tm_error","Invalid Receiver")},0),s;if(void 0===e.is_group)return setTimeout(function(){s.emit("tm_error","Value for 'is_group' not specified")},0),s;if(void 0===e.is_room&&(e.is_room=0),"number"!=typeof e.is_group)return setTimeout(function(){s.emit("tm_error","Invalid value specified for 'is_group'")},0),s;if(""===e.attachment)return setTimeout(function(){s.emit("tm_error","Attachment cannot be empty")},0),s;void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),e.is_group=parseInt(e.is_group),e.is_room=parseInt(e.is_room),e.access_token=this.access_token,void 0===e.receiver_uid&&(e.receiver_uid=""),void 0===e.sender_uid&&(e.sender_uid=""),this.socket.emit("send_audio_message",{receiver_id:e.receiver_id,is_group:e.is_group,is_room:e.is_room,access_token:e.access_token,attachment:e.attachment,conversation_reference_id:e.conversation_reference_id,receiver_uid:e.receiver_uid,sender_uid:e.sender_uid,entity:1===e.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER}),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}return s}messageDelivered(e){let t=new Emitter;return"connected"!==this.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==e&&e&&"object"==typeof e?void 0!==e.message_id&&e.message_id?void 0===e.is_group?(setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t):void 0!==e.is_room&&e.is_room?(setTimeout(function(){t.emit("tm_error","Cannot trigger this operation for Rooms")},0),t):"number"!=typeof e.is_group?(setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t):(e.access_token=this.access_token,this.socket.emit("message_delivered",{message_id:e.message_id,is_group:e.is_group,access_token:e.access_token}),this.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t):(setTimeout(function(){t.emit("tm_error","Invalid Message")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)}messageRead(e){let t=new Emitter;return"connected"!==this.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==e&&e&&"object"==typeof e?void 0!==e.message_id&&e.message_id?void 0===e.is_group?(setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t):void 0!==e.is_room&&e.is_room?(setTimeout(function(){t.emit("tm_error","Cannot trigger this operation for Rooms")},0),t):"number"!=typeof e.is_group?(setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t):(e.access_token=this.access_token,this.socket.emit("message_read",{message_id:e.message_id,is_group:e.is_group,access_token:e.access_token}),this.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t):(setTimeout(function(){t.emit("tm_error","Invalid Message")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)}sendContact(e,t){let s=new Emitter;if("connected"!==this.connection_state)return setTimeout(function(){s.emit("tm_error","Connection to server is not yet established!")},0),s;if(void 0===e||!e||"object"!=typeof e)return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;if(void 0!==t&&t.is_forkout){if(!Array.isArray(e))return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;for(let t=0;t<e.length;t++)e[t].access_token=this.access_token,e[t].message_type=constants.MESSAGE_TYPE.CONTACT;this.socket.emit("fork_out",e),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}else{if(void 0===e.receiver_id||!e.receiver_id)return setTimeout(function(){s.emit("tm_error","Invalid Receiver")},0),s;if(void 0===e.is_group)return setTimeout(function(){s.emit("tm_error","Value for 'is_group' not specified")},0),s;if(void 0===e.is_room&&(e.is_room=0),"number"!=typeof e.is_group)return setTimeout(function(){s.emit("tm_error","Invalid value specified for 'is_group'")},0),s;if(""===e.contact_name||void 0===e.contact_name)return setTimeout(function(){s.emit("tm_error","Value for 'contact_name' is required")},0),s;if(""===e.contact_number||void 0===e.contact_number)return setTimeout(function(){s.emit("tm_error","Value for 'contact_number' is required")},0),s;void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),e.is_group=parseInt(e.is_group),e.is_room=parseInt(e.is_room),e.access_token=this.access_token,void 0===e.receiver_uid&&(e.receiver_uid=""),void 0===e.sender_uid&&(e.sender_uid=""),this.socket.emit("send_contact",{receiver_id:e.receiver_id,is_group:e.is_group,is_room:e.is_room,access_token:e.access_token,contact_name:e.contact_name,contact_number:e.contact_number,conversation_reference_id:e.conversation_reference_id,receiver_uid:e.receiver_uid,sender_uid:e.sender_uid,entity:1===e.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER}),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}return s}sendLocation(e,t){let s=new Emitter;if("connected"!==this.connection_state)return setTimeout(function(){s.emit("tm_error","Connection to server is not yet established!")},0),s;if(void 0===e||!e||"object"!=typeof e)return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;if(void 0!==t&&t.is_forkout){if(!Array.isArray(e))return setTimeout(function(){s.emit("tm_error","Invalid Data")},0),s;for(let t=0;t<e.length;t++)e[t].access_token=this.access_token,e[t].message_type=constants.MESSAGE_TYPE.LOCATION;this.socket.emit("fork_out",e),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}else{if(void 0===e.receiver_id||!e.receiver_id)return setTimeout(function(){s.emit("tm_error","Invalid Receiver")},0),s;if(void 0===e.is_group)return setTimeout(function(){s.emit("tm_error","Value for 'is_group' not specified")},0),s;if(void 0===e.is_room&&(e.is_room=0),"number"!=typeof e.is_group)return setTimeout(function(){s.emit("tm_error","Invalid value specified for 'is_group'")},0),s;if(""===e.location_latitude||void 0===e.location_latitude)return setTimeout(function(){s.emit("tm_error","Value for 'location_latitude' is required")},0),s;if(""===e.location_longitude||void 0===e.location_longitude)return setTimeout(function(){s.emit("tm_error","Value for 'location_longitude' is required")},0),s;if(""===e.location_address||void 0===e.location_address)return setTimeout(function(){s.emit("tm_error","Value for 'location_address' is required")},0),s;if(""===e.location_name||void 0===e.location_name)return setTimeout(function(){s.emit("tm_error","Value for 'location_name' is required")},0),s;void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),e.is_group=parseInt(e.is_group),e.is_room=parseInt(e.is_room),e.access_token=this.access_token,void 0===e.receiver_uid&&(e.receiver_uid=""),void 0===e.sender_uid&&(e.sender_uid=""),this.socket.emit("send_location",{receiver_id:e.receiver_id,is_group:e.is_group,is_room:e.is_room,access_token:e.access_token,location_latitude:e.location_latitude,location_longitude:e.location_longitude,location_address:e.location_address,location_name:e.location_name,conversation_reference_id:e.conversation_reference_id,receiver_uid:e.receiver_uid,sender_uid:e.sender_uid,entity:1===e.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER}),this.socket.once("tm_error",function(e){s.emit("tm_error",e)})}return s}sendActivityMessage(e){let t=new Emitter;return"connected"!==this.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==e&&e&&"object"==typeof e?void 0!==e.receiver_id&&e.receiver_id?""===e.message?(setTimeout(function(){t.emit("tm_error","Message cannot be empty")},0),t):"object"!=typeof e.message?(setTimeout(function(){t.emit("tm_error","Message must be JSON object")},0),t):(void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),void 0===e.receiver_uid&&(e.receiver_uid=""),void 0===e.sender_uid&&(e.sender_uid=""),e.is_group=0,e.is_room=0,e.access_token=this.access_token,this.socket.emit("send_activity_message",{receiver_id:e.receiver_id,is_group:e.is_group,is_room:e.is_room,access_token:e.access_token,message:e.message,conversation_reference_id:e.conversation_reference_id,receiver_uid:e.receiver_uid,sender_uid:e.sender_uid}),void this.socket.once("tm_error",function(e){t.emit("tm_error",e)})):(setTimeout(function(){t.emit("tm_error","Invalid Receiver")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)}getOnlineUsers(){let e=new Emitter;return this.socket.emit("get_user_availability_status",{access_token:this.access_token}),this.socket.once("user_availability_status",function(t){e.emit("online_users",t)}),this.socket.once("tm_error",function(t){e.emit("tm_error",t)}),e}setTyping(e){let t=new Emitter;return void 0!==e&&e&&"object"==typeof e?void 0!==e.receiver_id&&e.receiver_id?(void 0===e.is_group&&(e.is_group=0),void 0===e.typing&&(e.typing=0),void 0===e.typing_user_name&&(e.typing_user_name=""),e.access_token=this.access_token,this.socket.emit("typing",{receiver_id:e.receiver_id,is_group:e.is_group,access_token:e.access_token,typing:e.typing,typing_user_name:e.typing_user_name}),t):(setTimeout(function(){t.emit("tm_error","Invalid Receiver")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)}getMessageTime(e){return getDate(e)}getMessageDeliveryStatusText(e,t){let s;return s=1===e?constants.MESSAGE_DELIVERY_STATUS_READ_TEXT:1===t?constants.MESSAGE_DELIVERY_STATUS_DELIVERED_TEXT:2===t?constants.MESSAGE_DELIVERY_STATUS_PENDING_TEXT:constants.MESSAGE_DELIVERY_STATUS_SENT_TEXT}messageType(){return{TEXT:constants.MESSAGE_TYPE.TEXT,ATTACHMENT:constants.MESSAGE_TYPE.ATTACHMENT,CONTACT:constants.MESSAGE_TYPE.CONTACT,LOCATION:constants.MESSAGE_TYPE.LOCATION,GROUP_CREATED:constants.MESSAGE_TYPE.GROUP_CREATED,GROUP_NAME_UPDATED:constants.MESSAGE_TYPE.GROUP_NAME_UPDATED,GROUP_AVATAR_UPDATED:constants.MESSAGE_TYPE.GROUP_AVATAR_UPDATED,GROUP_STATUS_UPDATED:constants.MESSAGE_TYPE.GROUP_STATUS_UPDATED,GROUP_MEMBER_EXITED:constants.MESSAGE_TYPE.GROUP_MEMBER_EXITED,GROUP_MEMBER_ADDED:constants.MESSAGE_TYPE.GROUP_MEMBER_ADDED,GROUP_MEMBER_DELETED:constants.MESSAGE_TYPE.GROUP_MEMBER_DELETED,GROUP_MEMBER_ROLE_UPDATED:constants.MESSAGE_TYPE.GROUP_MEMBER_ROLE_UPDATED,ACTIVITY:constants.MESSAGE_TYPE.MESSAGE_TYPE_ACTIVITY,AUDIO_MESSAGE:constants.MESSAGE_TYPE.AUDIO_MESSAGE,META_LINK:constants.MESSAGE_TYPE.META_LINK,ROOM_CREATED:constants.MESSAGE_TYPE.ROOM_CREATED,ROOM_NAME_UPDATED:constants.MESSAGE_TYPE.ROOM_NAME_UPDATED,ROOM_AVATAR_UPDATED:constants.MESSAGE_TYPE.ROOM_AVATAR_UPDATED,ROOM_STATUS_UPDATED:constants.MESSAGE_TYPE.ROOM_STATUS_UPDATED,ROOM_MEMBER_EXITED:constants.MESSAGE_TYPE.ROOM_MEMBER_EXITED,MESSAGE_TYPE_ROOM_MEMBER_JOINED:constants.MESSAGE_TYPE.MESSAGE_TYPE_ROOM_MEMBER_JOINED}}entity(){return{USER:constants.ENTITY.USER,GROUP:constants.ENTITY.GROUP}}groupMemberRole(){return{ADMIN:constants.GROUP_ROLE_ADMIN,NORMAL:constants.GROUP_ROLE_NORMAL,MODERATOR:constants.GROUP_ROLE_MODERATOR}}roomMemberRole(){return{ADMIN:constants.ROOM_ROLE_ADMIN,NORMAL:constants.ROOM_ROLE_NORMAL,MODERATOR:constants.ROOM_ROLE_MODERATOR}}parseMessage(e){try{return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}catch(t){return e}}reply(){let e=this,t=new Emitter;return{text:function(s){return"connected"!==e.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==s&&s&&"object"==typeof s?void 0!==s.message_id&&s.message_id?void 0!==s.receiver_id&&s.receiver_id?void 0===s.is_group?(setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t):(void 0===s.is_room&&(s.is_room=0),"number"!=typeof s.is_group?(setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t):""===s.message?(setTimeout(function(){t.emit("tm_error","Message cannot be empty")},0),t):(void 0===s.conversation_reference_id&&(s.conversation_reference_id=""),void 0===s.receiver_uid&&(s.receiver_uid=""),void 0===s.sender_uid&&(s.sender_uid=""),s.is_group=parseInt(s.is_group),s.is_room=parseInt(s.is_room),s.access_token=e.access_token,e.socket.emit("reply_message",{message_id:s.message_id,message_type:constants.MESSAGE_TYPE.TEXT,receiver_id:s.receiver_id,is_group:s.is_group,is_room:s.is_room,access_token:s.access_token,message:s.message,conversation_reference_id:s.conversation_reference_id,receiver_uid:s.receiver_uid,sender_uid:s.sender_uid,entity:1===s.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER,caption:"",attachment:"",status:1}),e.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t)):(setTimeout(function(){t.emit("tm_error","Invalid Receiver")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Message")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)},attachment:function(s){return"connected"!==e.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==s&&s&&"object"==typeof s?void 0!==s.message_id&&s.message_id?void 0!==s.receiver_id&&s.receiver_id?void 0===s.is_group?(setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t):(void 0===s.is_room&&(s.is_room=0),"number"!=typeof s.is_group?(setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t):""===s.attachment?(setTimeout(function(){t.emit("tm_error","Attachment cannot be empty")},0),t):(void 0===s.caption&&(s.caption=""),void 0===s.conversation_reference_id&&(s.conversation_reference_id=""),void 0===s.receiver_uid&&(s.receiver_uid=""),void 0===s.sender_uid&&(s.sender_uid=""),s.is_group=parseInt(s.is_group),s.is_room=parseInt(s.is_room),s.access_token=e.access_token,e.socket.emit("reply_message",{message_id:s.message_id,message_type:constants.MESSAGE_TYPE.ATTACHMENT,receiver_id:s.receiver_id,is_group:s.is_group,is_room:s.is_room,access_token:s.access_token,message:"",conversation_reference_id:s.conversation_reference_id,receiver_uid:s.receiver_uid,sender_uid:s.sender_uid,entity:1===s.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER,caption:s.caption,attachment:s.attachment,status:1}),e.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t)):(setTimeout(function(){t.emit("tm_error","Invalid Receiver")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Message")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)},contact:function(s){return"connected"!==e.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==s&&s&&"object"==typeof s?void 0!==s.message_id&&s.message_id?void 0!==s.receiver_id&&s.receiver_id?void 0===s.is_group?(setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t):(void 0===s.is_room&&(s.is_room=0),"number"!=typeof s.is_group?(setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t):""===s.contact_name||void 0===s.contact_name?(setTimeout(function(){t.emit("tm_error","Value for 'contact_name' is required")},0),t):""===s.contact_number||void 0===s.contact_number?(setTimeout(function(){t.emit("tm_error","Value for 'contact_number' is required")},0),t):(void 0===s.conversation_reference_id&&(s.conversation_reference_id=""),void 0===s.receiver_uid&&(s.receiver_uid=""),void 0===s.sender_uid&&(s.sender_uid=""),s.is_group=parseInt(s.is_group),s.is_room=parseInt(s.is_room),s.access_token=e.access_token,e.socket.emit("reply_message",{message_id:s.message_id,message_type:constants.MESSAGE_TYPE.CONTACT,receiver_id:s.receiver_id,is_group:s.is_group,is_room:s.is_room,access_token:s.access_token,message:"",conversation_reference_id:s.conversation_reference_id,receiver_uid:s.receiver_uid,sender_uid:s.sender_uid,entity:1===s.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER,caption:"",attachment:"",status:1,contact_name:s.contact_name,contact_number:s.contact_number}),e.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t)):(setTimeout(function(){t.emit("tm_error","Invalid Receiver")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Message")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)},location:function(s){return"connected"!==e.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==s&&s&&"object"==typeof s?void 0!==s.message_id&&s.message_id?void 0!==s.receiver_id&&s.receiver_id?void 0===s.is_group?(setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t):(void 0===s.is_room&&(s.is_room=0),"number"!=typeof s.is_group?(setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t):""===s.location_latitude||void 0===s.location_latitude?(setTimeout(function(){t.emit("tm_error","Value for 'location_latitude' is required")},0),t):""===s.location_longitude||void 0===s.location_longitude?(setTimeout(function(){t.emit("tm_error","Value for 'location_longitude' is required")},0),t):""===s.location_address||void 0===s.location_address?(setTimeout(function(){t.emit("tm_error","Value for 'location_address' is required")},0),t):""===s.location_name||void 0===s.location_name?(setTimeout(function(){t.emit("tm_error","Value for 'location_name' is required")},0),t):(void 0===s.conversation_reference_id&&(s.conversation_reference_id=""),void 0===s.receiver_uid&&(s.receiver_uid=""),void 0===s.sender_uid&&(s.sender_uid=""),s.is_group=parseInt(s.is_group),s.is_room=parseInt(s.is_room),s.access_token=e.access_token,e.socket.emit("reply_message",{message_id:s.message_id,message_type:constants.MESSAGE_TYPE.LOCATION,receiver_id:s.receiver_id,is_group:s.is_group,is_room:s.is_room,access_token:s.access_token,message:"",conversation_reference_id:s.conversation_reference_id,receiver_uid:s.receiver_uid,sender_uid:s.sender_uid,entity:1===s.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER,caption:"",attachment:"",status:1,location_latitude:s.location_latitude,location_longitude:s.location_longitude,location_address:s.location_address,location_name:s.location_name}),e.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t)):(setTimeout(function(){t.emit("tm_error","Invalid Receiver")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Message")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)},audioMessage:function(s){return"connected"!==e.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==s&&s&&"object"==typeof s?void 0!==s.message_id&&s.message_id?void 0!==s.receiver_id&&s.receiver_id?void 0===s.is_group?(setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t):(void 0===s.is_room&&(s.is_room=0),"number"!=typeof s.is_group?(setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t):""===s.attachment?(setTimeout(function(){t.emit("tm_error","Attachment cannot be empty")},0),t):(void 0===s.conversation_reference_id&&(s.conversation_reference_id=""),void 0===s.receiver_uid&&(s.receiver_uid=""),void 0===s.sender_uid&&(s.sender_uid=""),s.is_group=parseInt(s.is_group),s.is_room=parseInt(s.is_room),s.access_token=e.access_token,e.socket.emit("reply_message",{message_id:s.message_id,message_type:constants.MESSAGE_TYPE.AUDIO_MESSAGE,receiver_id:s.receiver_id,is_group:s.is_group,is_room:s.is_room,access_token:s.access_token,message:"",conversation_reference_id:s.conversation_reference_id,receiver_uid:s.receiver_uid,sender_uid:s.sender_uid,entity:1===s.is_group?constants.ENTITY_GROUP:constants.ENTITY_USER,caption:"",attachment:s.attachment,status:1}),e.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t)):(setTimeout(function(){t.emit("tm_error","Invalid Receiver")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Message")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)}}}forwardMessage(e){let t=new Emitter;return"connected"!==this.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==e&&e&&"object"==typeof e?void 0!==e.message_id&&Array.isArray(e.message_id)?void 0!==e.forward_to&&Array.isArray(e.forward_to)?void 0===e.is_group?(setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t):"number"!=typeof e.is_group?(setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t):""===e.message?(setTimeout(function(){t.emit("tm_error","Message cannot be empty")},0),t):(void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),e.is_group=parseInt(e.is_group),e.access_token=this.access_token,this.socket.emit("forward_message",{forward_to:e.forward_to,is_group:e.is_group,access_token:e.access_token,message_id:e.message_id,conversation_reference_id:e.conversation_reference_id,status:1,reference_id:[],is_forward:1}),this.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t):(setTimeout(function(){t.emit("tm_error","Invalid Receiver")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Message(s)")},0),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)}deleteMessage(e,t){return void 0!==t&&"function"==typeof t&&("connected"!==this.connection_state?t({status:!1,message:"Connection to server is not yet established!"}):void 0!==e&&e&&"object"==typeof e?void 0!==e.message_id&&Array.isArray(e.message_id)?void 0===e.entity_type?t({status:!1,message:"Value for 'entity_type' is not specified"}):void 0===e.entity_id?t({status:!1,message:"Value for 'entity_id' is not specified"}):(void 0===e.is_room&&(e.is_room=0),e.is_room=parseInt(e.is_room),e.access_token=this.access_token,void this.socket.emit("delete_message",{message_id:e.message_id,entity_type:e.entity_type,entity_id:e.entity_id,access_token:e.access_token,is_room:e.is_room},function(e){return t(e)})):t({status:!1,message:"Invalid Message(s)"}):t({status:!1,message:"Invalid Data"}))}recallMessage(e,t){return void 0!==t&&"function"==typeof t&&("connected"!==this.connection_state?t({status:!1,message:"Connection to server is not yet established!"}):void 0!==e&&e&&"object"==typeof e?void 0!==e.message_id&&Array.isArray(e.message_id)?void 0===e.entity_type?t({status:!1,message:"Value for 'entity_type' is not specified"}):void 0===e.entity_id?t({status:!1,message:"Value for 'entity_id' is not specified"}):(void 0===e.is_room&&(e.is_room=0),e.is_room=parseInt(e.is_room),e.access_token=this.access_token,void this.socket.emit("recall_message",{message_id:e.message_id,entity_type:e.entity_type,entity_id:e.entity_id,access_token:e.access_token,is_room:e.is_room},function(e){return t(e)})):t({status:!1,message:"Invalid Message(s)"}):t({status:!1,message:"Invalid Data"}))}editMessage(e,t){return void 0!==t&&"function"==typeof t&&("connected"!==this.connection_state?t({status:!1,message:"Connection to server is not yet established!"}):void 0!==e&&e&&"object"==typeof e?void 0!==e.message_id&&e.message_id?void 0===e.message?t({status:!1,message:"Message cannot be empty"}):void 0===e.is_group?t({status:!1,message:"Value for 'is_group' not specified"}):(void 0===e.is_room&&(e.is_room=0),"number"!=typeof e.is_group?t({status:!1,message:"Invalid value specified for 'is_group'"}):(e.access_token=this.access_token,void this.socket.emit("edit_message",{message_id:e.message_id,message:e.message,is_group:e.is_group,is_room:e.is_room,access_token:e.access_token},function(e){return t(e)}))):t({status:!1,message:"Invalid Message"}):t({status:!1,message:"Invalid Data"}))}groupUpdatePayload(){return{GROUP_NAME:constants.PAYLOAD_UPDATE_GROUP_NAME,GROUP_AVATAR:constants.PAYLOAD_UPDATE_GROUP_AVATAR,GROUP_STATUS:constants.PAYLOAD_UPDATE_GROUP_STATUS,EXIT_GROUP:constants.PAYLOAD_EXIT_GROUP,GROUP_MEMBERS_ADDED:constants.PAYLOAD_ADD_GROUP_MEMBERS,GROUP_MEMBERS_DELETED:constants.PAYLOAD_DELETE_GROUP_MEMBERS,GROUP_MEMBER_ROLE_UPDATED:constants.PAYLOAD_UPDATE_GROUP_USER_ROLE}}roomUpdatePayload(){return{ROOM_NAME:constants.PAYLOAD_UPDATE_ROOM_NAME,ROOM_AVATAR:constants.PAYLOAD_UPDATE_ROOM_AVATAR,ROOM_STATUS:constants.PAYLOAD_UPDATE_ROOM_STATUS,EXIT_ROOM:constants.PAYLOAD_EXIT_ROOM,PAYLOAD_JOIN_ROOM:constants.PAYLOAD_JOIN_ROOM}}async getConversation(e){return void 0!==e&&e&&"object"==typeof e?(void 0===e.last_message_id&&(e.last_message_id=0),void 0===e.is_group?{success:!1,message:"Value for 'is_group' not specified"}:(void 0===e.is_room&&(e.is_room=0),"number"!=typeof e.is_group?{success:!1,message:"Invalid value specified for 'is_group'"}:void 0===e.entity_id?{success:!1,message:"Value for 'is_group' not specified"}:e.entity_id?(void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),void 0===e.ignore_message_type&&(e.ignore_message_type=[]),Array.isArray(e.ignore_message_type)?(e.ignore_message_type=JSON.stringify(e.ignore_message_type),await this.axiosRequest.post("/api/messenger/get-conversation",{socket_id:this.socket_id,user_id:this.user_id,access_token:this.access_token,token:this.token,last_message_id:e.last_message_id,is_group:e.is_group,is_room:e.is_room,entity_id:e.entity_id,conversation_reference_id:e.conversation_reference_id,ignore_message_type:e.ignore_message_type,limit:50,sort:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})):{success:!1,message:"Invalid value specified for 'ignore_message_type'"}):{success:!1,message:"Invalid value specified for 'is_group'"})):{success:!1,message:"Invalid data"}}async getMessages(e){let t="";return void 0!==e&&void 0!==e.conversation_reference_id&&(t=e.conversation_reference_id),await this.axiosRequest.post("/api/messenger/get-messages",{socket_id:this.socket_id,user_id:this.user_id,access_token:this.access_token,token:this.token,conversation_reference_id:t}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})}async getChatList(e){let t="";return void 0!==e&&void 0!==e.conversation_reference_id&&(t=e.conversation_reference_id),await this.axiosRequest.post("/api/messenger/get-chat-list",{socket_id:this.socket_id,user_id:this.user_id,access_token:this.access_token,token:this.token,conversation_reference_id:t}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})}async updateGroupMemberStatus(e){return void 0!==e&&e&&"object"==typeof e?void 0!==e.group_id&&e.group_id&&""!==e.group_id?void 0!==e.member_role&&e.member_role&&-1!==constants.VALID_GROUP_MEMBER_ROLE.indexOf(e.member_role)?void 0!==e.member_id&&e.member_id?await this.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_UPDATE_GROUP_USER_ROLE,group_id:e.group_id,member_id:e.member_id,user_role:e.member_role,socket_id:this.socket_id,user_id:this.user_id,access_token:this.access_token,token:this.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid member"}:{success:!1,message:"Invalid member role"}:{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}}group(){let e=this;return{create:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0===t.group_name||""===t.group_name?{success:!1,message:"Group name is required"}:(void 0===t.group_description&&(t.group_description=""),void 0===t.group_avatar&&(t.group_avatar=""),void 0===t.members||""===t.members?{success:!1,message:"Group members are required"}:Array.isArray(t.members)?t.members.length?(void 0===t.conversation_reference_id&&(t.conversation_reference_id=""),await e.axiosRequest.post("/api/messenger/create-group",{socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,group_name:t.group_name,group_description:t.group_description,group_avatar:t.group_avatar,group_members:JSON.stringify(t.members),platform:1,conversation_reference_id:t.conversation_reference_id}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})):{success:!1,message:"Group members are required"}:{success:!1,message:"Invalid data passed for 'members'"}):{success:!1,message:"Invalid data"}},updateName:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?void 0!==t.group_name&&t.group_name&&""!==t.group_name?(t.group_name=t.group_name.toString(),t.group_name.length<1?{success:!1,message:"Group Name cannot be empty"}:t.group_name.length>constants.MAX_GROUP_NAME_CHARACTERS?{success:!1,message:"Maximum "+constants.MAX_GROUP_NAME_CHARACTERS+" characters are allowed for Group Name"}:await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_UPDATE_GROUP_NAME,group_id:t.group_id,group_name:t.group_name,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})):{success:!1,message:"Invalid Group Name"}:{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},updateAvatar:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?(void 0!==t.group_avatar&&t.group_avatar||(t.group_avatar=""),await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_UPDATE_GROUP_AVATAR,group_id:t.group_id,group_avatar:t.group_avatar,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})):{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},makeAdmin:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?void 0!==t.member_id&&t.member_id?await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_UPDATE_GROUP_USER_ROLE,group_id:t.group_id,member_id:t.member_id,user_role:constants.GROUP_ROLE_ADMIN,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid member"}:{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},makeModerator:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?void 0!==t.member_id&&t.member_id?await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_UPDATE_GROUP_USER_ROLE,group_id:t.group_id,member_id:t.member_id,user_role:constants.GROUP_ROLE_MODERATOR,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid member"}:{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},removeAdmin:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?void 0!==t.member_id&&t.member_id?await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_UPDATE_GROUP_USER_ROLE,group_id:t.group_id,member_id:t.member_id,user_role:constants.GROUP_ROLE_NORMAL,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid member"}:{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},removeModerator:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?void 0!==t.member_id&&t.member_id?await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_UPDATE_GROUP_USER_ROLE,group_id:t.group_id,member_id:t.member_id,user_role:constants.GROUP_ROLE_NORMAL,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid member"}:{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},removeUser:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?void 0!==t.member_id&&t.member_id?await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_DELETE_GROUP_MEMBERS,group_id:t.group_id,group_members:t.member_id+"",socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid member"}:{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},delete:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_UPDATE_GROUP_STATUS,group_id:t.group_id,delete_group:1,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},exit:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.group_id&&t.group_id&&""!==t.group_id?await e.axiosRequest.post("/api/messenger/update-group",{payload:constants.PAYLOAD_EXIT_GROUP,group_id:t.group_id,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid Group"}:{success:!1,message:"Invalid data"}},addMembers:async function(t){return void 0===t||"object"!=typeof t?{success:!1,message:"Invalid data"}:void 0!==t.group_id&&t.group_id?void 0!==t.members&&Array.isArray(t.members)&&t.members.length?await e.axiosRequest.post("/api/messenger/add-group-members",{group_id:t.group_id,group_members:JSON.stringify(t.members),socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Member(s) are required"}:{success:!1,message:"Invalid Group"}},details:async function(t){return void 0===t||"object"!=typeof t?{success:!1,message:"Invalid data"}:void 0!==t.group_id&&t.group_id?await e.axiosRequest.post("/api/messenger/get-group-details",{group_id:t.group_id,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid Group"}}}}room(){let e=this;return{create:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0===t.room_name||""===t.room_name?{success:!1,message:"Room name is required"}:(void 0===t.room_description&&(t.room_description=""),void 0===t.room_avatar&&(t.room_avatar=""),void 0===t.conversation_reference_id&&(t.conversation_reference_id=""),await e.axiosRequest.post("/api/messenger/create-room",{socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,room_name:t.room_name,room_description:t.room_description,room_avatar:t.room_avatar,platform:1,conversation_reference_id:t.conversation_reference_id}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})):{success:!1,message:"Invalid data"}},updateName:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.room_id&&t.room_id&&""!==t.room_id?void 0!==t.room_name&&t.room_name&&""!==t.room_name?(t.room_name=t.room_name.toString(),t.room_name.length<1?{success:!1,message:"Room Name cannot be empty"}:t.room_name.length>constants.MAX_GROUP_NAME_CHARACTERS?{success:!1,message:"Maximum "+constants.MAX_GROUP_NAME_CHARACTERS+" characters are allowed for Room Name"}:await e.axiosRequest.post("/api/messenger/update-room",{payload:constants.PAYLOAD_UPDATE_ROOM_NAME,room_id:t.room_id,room_name:t.room_name,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})):{success:!1,message:"Invalid Room Name"}:{success:!1,message:"Invalid Room"}:{success:!1,message:"Invalid data"}},updateAvatar:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.room_id&&t.room_id&&""!==t.room_id?(void 0!==t.room_avatar&&t.room_avatar||(t.room_avatar=""),await e.axiosRequest.post("/api/messenger/update-room",{payload:constants.PAYLOAD_UPDATE_ROOM_AVATAR,room_id:t.room_id,room_avatar:t.room_avatar,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})):{success:!1,message:"Invalid Room"}:{success:!1,message:"Invalid data"}},delete:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.room_id&&t.room_id&&""!==t.room_id?await e.axiosRequest.post("/api/messenger/update-room",{payload:constants.PAYLOAD_UPDATE_ROOM_STATUS,room_id:t.room_id,delete_room:1,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid Room"}:{success:!1,message:"Invalid data"}},exit:async function(t){return void 0!==t&&t&&"object"==typeof t?void 0!==t.room_id&&t.room_id&&""!==t.room_id?await e.axiosRequest.post("/api/messenger/update-room",{payload:constants.PAYLOAD_EXIT_ROOM,room_id:t.room_id,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid Room"}:{success:!1,message:"Invalid data"}},details:async function(t){return void 0===t||"object"!=typeof t?{success:!1,message:"Invalid data"}:void 0!==t.room_id&&t.room_id?await e.axiosRequest.post("/api/messenger/get-room-details",{room_id:t.roo,_id:_id,socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid Room"}},join:async function(t){return void 0===t||"object"!=typeof t?{success:!1,message:"Invalid data"}:void 0!==t.room_id&&t.room_id?await e.axiosRequest.post("/api/messenger/update-room",{room_id:t.room_id,room_members:e.user_id+"",socket_id:e.socket_id,user_id:e.user_id,access_token:e.access_token,token:e.token,platform:1,payload:constants.PAYLOAD_JOIN_ROOM}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}}):{success:!1,message:"Invalid Room"}}}}getIndividualUnreadMessagesCount(e){let t=new Emitter;if("connected"!==this.connection_state)return setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t;if(void 0===e||!e||"object"!=typeof e)return setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t;if(void 0===e.sender_id||!e.sender_id)return setTimeout(function(){t.emit("tm_error","Invalid Sender")},0),t;if(void 0===e.is_group)return setTimeout(function(){t.emit("tm_error","Value for 'is_group' not specified")},0),t;if("number"!=typeof e.is_group)return setTimeout(function(){t.emit("tm_error","Invalid value specified for 'is_group'")},0),t;if(e.is_group){if(void 0===e.group_id||!e.group_id)return setTimeout(function(){t.emit("tm_error","Value for 'group_id' not specified")},0),t;if("number"!=typeof e.group_id)return setTimeout(function(){t.emit("tm_error","Invalid value specified for 'group_id'")},0),t}return void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),e.access_token=this.access_token,this.socket.emit("unread_messages_count",{is_group:e.is_group,access_token:e.access_token,sender_id:e.sender_id,conversation_reference_id:e.conversation_reference_id,group_id:e.group_id}),this.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t}getAllUnreadMessagesCount(e){let t=new Emitter;return"connected"!==this.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0!==e&&e&&"object"==typeof e?(void 0===e.conversation_reference_id&&(e.conversation_reference_id=""),e.access_token=this.access_token,this.socket.emit("unread_messages_count",{access_token:e.access_token,conversation_reference_id:e.conversation_reference_id}),this.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t):(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t)}updateStatus(e){let t=new Emitter;return"connected"!==this.connection_state?(setTimeout(function(){t.emit("tm_error","Connection to server is not yet established!")},0),t):void 0===e||""===e||"string"!=typeof e?(setTimeout(function(){t.emit("tm_error","Invalid Data")},0),t):-1===Object.keys(this.statuses).indexOf(e)?(setTimeout(function(){t.emit("tm_error","Invalid status")},0),t):(this.socket.emit("update_status",{status:e,uis:this.uid,access_token:this.access_token}),this.socket.once("tm_error",function(e){t.emit("tm_error",e)}),t)}getUserStatuses(){let e=new Emitter;return this.socket.emit("get_user_status",{access_token:this.access_token}),this.socket.once("get_user_status",function(t){e.emit("get_user_statuses",t)}),this.socket.once("tm_error",function(t){e.emit("tm_error",t)}),e}getStatusText(e){return void 0!==$this.statuses[e]?$this.statuses[e]:""}}function getDate(e,t){var s=moment(e).toDate(),o=(s=getTimeZoneDate(s)).toLocaleString("en-US",{month:"long"}),i=prependZero(s.getDate().toString()),r=prependZero(s.getHours().toString())+":"+prependZero(s.getMinutes().toString());return t?o+" "+i+"  "+r:r}function getTimeZoneDate(e){return localize(convertDateToUTC(e))}function localize(e){var t=moment.utc(moment(e).format("YYYY-MM-DD HH:mm:ss")).toDate();return t=moment(moment(t).format("YYYY-MM-DD HH:mm:ss")).toDate()}function convertDateToUTC(e){var t=moment(e).toDate();return moment(t.getTime()+-198e5).toDate()}function prependZero(e){return e.length<2?"0"+e:e}async function register(e,t,s,o=0){return void 0===e||""===e?{success:!1,message:"uid is required"}:void 0===t||""===t?{success:!1,message:"name is required"}:await $this.axiosRequest.post("/api/messenger/v2/register",{token:s,uid:e,name:t,behalf:o}).then(async function(e){return e.data}).catch(function(e){return{success:!1,message:e.message}})}module.exports=TroopMessenger,global.TroopMessenger=TroopMessenger;